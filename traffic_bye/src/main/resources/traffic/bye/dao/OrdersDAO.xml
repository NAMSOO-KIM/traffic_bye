<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="traffic.bye.dao.OrdersDAO">
	<insert id="insertOrders" parameterType="OrdersVO">
	insert into orders(id, member_id , departure_date, payment_date, status , amount , destination_id, cigarette_amount, drink_amount, perfume_amount)
values(order_id_seq.nextval, #{memberId}, sysdate, sysdate, 0 , #{amount} , 1,2,0,0)
	</insert>
	
	<insert id="insertOrdersDetail" parameterType="OrdersDetailVO">
	insert into orders_detail(item_id, orders_id , store_id, quantity )
values(#{itemId}, order_id_seq.currval, #{storeId}, #{quantity})
	</insert>
	
	<select id="getOrderId" resultType="long">
	select order_id_seq.currval from dual
	</select>
	
	<select id="getOrderList" parameterType="long" resultType="OrdersManageVO">
	select distinct O.id ordersId, S.id storeId  , O.status status , O.amount amount , M.name memberName , O.payment_date paymentDate
from orders_detail D , orders O ,store S , member M
where O.id = D.orders_id
and D.store_id = S.id
and M.id = O.member_id
and S.id = #{storeId}
	</select>	

</mapper>