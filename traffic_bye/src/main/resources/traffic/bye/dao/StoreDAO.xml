<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="traffic.bye.dao.StoreDAO">

	
	<select id="getStoreList" resultType="StoreVO">
	<![CDATA[
	
		select *
		from store 
		
	]]>
	</select>
	
	<select id="getStore" parameterType="long" resultType="StoreVO">
	<![CDATA[
		select *
		from store 
		where id = #{id}
	]]>
	</select>
	
	<select id="getStoreCategories" parameterType="long" resultType="long">
	<![CDATA[
		select category_id
		from item
		where store_id = #{store_id}
		group by category_id
	]]>
	</select>
	
	<select id="getStoreStatus" parameterType="Long" resultType="StoreStatusVO">
	<![CDATA[
		select 
		lv status, nvl(cnt,0) cnt
		from
		(select (level - 1) lv from dual connect by level <= 4) info1
			left join
		(select detail_status, count(detail_status) cnt
		from 
		store join orders_detail od on store.id = #{storeId} and store.id = od.store_id 
		join orders on od.orders_id = orders.id
		where substr(payment_date,0,5) = to_char(sysdate + (1/24) * 9, 'YY/MM')
		group by detail_status) info2
		on lv = detail_status
		order by lv
	]]>	
	</select>
</mapper>