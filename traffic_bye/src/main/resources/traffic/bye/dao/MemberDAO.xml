<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="traffic.bye.dao.MemberDAO">
	<select id="checkPhoneDuplicate" parameterType="String" resultType="int">
		select count(*) from member where phone = #{phone}
	</select>
	
	<select id="checkKakaoDuplicate" parameterType="long" resultType="int">
		select count(*) from member where auth_id = #{authId}
	</select>
	
	<select id="checkIdDuplicate" parameterType="String" resultType="int">
		select count(*) from member where login_id = #{loginId}
	</select>
	
	<insert id="memberRegister" parameterType="MemberVO">
		insert into member values(member_id_seq.nextval, #{passport}, #{phone, jdbcType=NUMERIC}, #{name}, #{birth}, #{card}, #{cardCvc}, #{cardExpire}, #{role}, #{authType}, #{authId, jdbcType=NUMERIC}, #{loginId}, #{password})
	</insert>
	
	
	<select id="login" parameterType="LoginInfo" resultType="int">
		select count(*) from member where login_id = #{loginId} and password = #{password}
	</select>
	
	<select id="getLoginInfo" parameterType="String" resultType="LoginInfo">
      select member.id id, login_id loginId, password, store.id storeId from member left join store on member.id = store.manager_id where member.login_id = #{loginId} 
   	</select>

	<select id="findIdByKakaoId" parameterType="Long" resultType="String">
		select login_id loginId from member where auth_id = #{kakaoId}
	</select>
	
	<select id="findIdByPhone" parameterType="String" resultType="String">
		select login_id loginId from member where phone = #{phone}
	</select>
	
	<update id="testUpdate" parameterType="String">
		update member set password = #{pw} where id = 2
	</update>
	
	<select id="getRoleInfo" parameterType="String" resultType="String">
		select role from member where login_id = #{loginId}
	</select>
	
</mapper>